{% extends 'base.html' %}
{% block title %}Maps{% endblock %}
{% block head %}
<meta name="viewport" content="initial-scale=1.0">
<meta charset="utf-8">
<style>
    #map {
        height: 600px;
        width: 500px;
    }
    #floating-panel {
        position: absolute;
        top: 10px;
        left: 25%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }
</style>

{% endblock %}

{% block body %}

<div id="map"></div>
<script>
    console.log({{ myRoute|safe }});
    let start = {{ myRoute|safe }}['start'];
    console.log(start);
    let end = {{ myRoute|safe }}.end;
    console.log(end);
    let result;         //This would have response.routes[0].legs[0].steps latlng data
    console.log('hi');
    function createMap() {
        console.log('there')
        let map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 37.38 , lng: -121.94 },
                zoom: 10
            });
        console.log('hi');
        let directionsService = new google.maps.DirectionsService;
        let directionsDisplay = new google.maps.DirectionsRenderer;
        directionsDisplay.setMap(map);
        calculateAndDisplayRoute(directionsService, directionsDisplay);
    }

    function calculateAndDisplayRoute(directionsService, directionsDisplay) {
        directionsService.route({
            origin: start,
            destination: end,
            travelMode: 'DRIVING'
        }, function (response, status){
            console.log(start, end);
            if (status == 'OK') {
                directionsDisplay.setDirections(response);
                result = response;
            } else {
                window.alert('Directions request failed due to ' + status);
            }
        } );
    }
</script>

<script 
  src="https://maps.googleapis.com/maps/api/js?key={{YOUR_API_KEY}}&callback=createMap" async defer>
</script>

{% endblock %}