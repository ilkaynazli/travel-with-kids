{% extends 'base.html' %}
{% block title %}Maps{% endblock %}
{% block head %}

{% endblock %}

{% block body %}
<!-- <form action="/show-map" id='route-form'>
    From: <input type="text" name="start_location" required id="start"><br>
    To: <input type="text" name="end_location" required id="end"><br>
    <input type="submit">
</form> -->

<div id="map" data-start='{{start}}' data-end="{{end}}"></div>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
    function myCallBack(){
        const route = $("#map").data()
        console.log(route);
        const start = route['start'];
        const end = route['end'];
        console.log(start, end);

        function createMap() {
            const map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: 37.38 , lng: -121.94 },
                    zoom: 10
                });
           
            
            const directionsService = new google.maps.DirectionsService;
            const directionsDisplay = new google.maps.DirectionsRenderer;
            directionsDisplay.setMap(map);
            calculateAndDisplayRoute(directionsService, directionsDisplay);
        };
        function calculateAndDisplayRoute(directionsService, directionsDisplay) {
            directionsService.route({
                origin: start,
                destination: end,
                travelMode: 'DRIVING'
            }, function (response, status){
                if (status == 'OK') {
                    directionsDisplay.setDirections(response);
                    console.log(response)
                    // $.post("/get-route", response);  
                } else {
                    alert('Directions request failed due to ' + status);
                }
            });
        };
        createMap();
    }
</script>

<script 
  src="https://maps.googleapis.com/maps/api/js?key={{YOUR_API_KEY}}&callback=myCallBack" async defer>
</script>

{% endblock %}